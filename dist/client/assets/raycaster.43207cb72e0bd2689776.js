!function(t){function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="//swcho.github.io/ts_playground/dist/client/assets/",r(r.s=1839)}({1839:function(t,r,n){"use strict";function e(){return{things:[new f(new u(0,1,0),0,i.checkerboard),new a(new u(0,1,-.25),1,i.shiny),new a(new u(h,d,1.5),.5,i.shiny)],lights:[{pos:new u(-2,2.5,0),color:new s(.49,.07,.07)},{pos:new u(1.5,2.5,1.5),color:new s(.07,.07,.49)},{pos:new u(1.5,2.5,-1.5),color:new s(.07,.49,.071)},{pos:new u(0,3.5,0),color:new s(.21,.21,.35)}],camera:new c(new u(5,5,5),new u(-1,.5,0))}}function o(){var t=document.querySelector("canvas");t.width=256,t.height=256;var r=t.getContext("2d");return(new l).render(e(),r,256,256)}Object.defineProperty(r,"__esModule",{value:!0}),n(1840),n(1841);var i,u=function(){function t(t,r,n){this.x=t,this.y=r,this.z=n}return t.times=function(r,n){return new t(r*n.x,r*n.y,r*n.z)},t.minus=function(r,n){return new t(r.x-n.x,r.y-n.y,r.z-n.z)},t.plus=function(r,n){return new t(r.x+n.x,r.y+n.y,r.z+n.z)},t.dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z},t.mag=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},t.norm=function(r){var n=t.mag(r),e=0===n?1/0:1/n;return t.times(e,r)},t.cross=function(r,n){return new t(r.y*n.z-r.z*n.y,r.z*n.x-r.x*n.z,r.x*n.y-r.y*n.x)},t}(),s=function(){function t(t,r,n){this.r=t,this.g=r,this.b=n}return t.scale=function(r,n){return new t(r*n.r,r*n.g,r*n.b)},t.plus=function(r,n){return new t(r.r+n.r,r.g+n.g,r.b+n.b)},t.times=function(r,n){return new t(r.r*n.r,r.g*n.g,r.b*n.b)},t.toDrawingColor=function(t){var r=function(t){return t>1?1:t};return{r:Math.floor(255*r(t.r)),g:Math.floor(255*r(t.g)),b:Math.floor(255*r(t.b))}},t.white=new t(1,1,1),t.grey=new t(.5,.5,.5),t.black=new t(0,0,0),t.background=t.black,t.defaultColor=t.black,t}(),c=function(){function t(t,r){this.pos=t;var n=new u(0,-1,0);this.forward=u.norm(u.minus(r,this.pos)),this.right=u.times(1.5,u.norm(u.cross(this.forward,n))),this.up=u.times(1.5,u.norm(u.cross(this.forward,this.right)))}return t}(),a=function(){function t(t,r,n){this.center=t,this.surface=n,this.radius2=r*r}return t.prototype.normal=function(t){return u.norm(u.minus(t,this.center))},t.prototype.intersect=function(t){var r=u.minus(this.center,t.start),n=u.dot(r,t.dir),e=0;if(n>=0){var o=this.radius2-(u.dot(r,r)-n*n);o>=0&&(e=n-Math.sqrt(o))}return 0===e?null:{thing:this,ray:t,dist:e}},t}(),f=function(){function t(t,r,n){this.surface=n,this.normal=function(r){return t},this.intersect=function(n){var e=u.dot(t,n.dir);return e>0?null:{thing:this,ray:n,dist:(u.dot(t,n.start)+r)/-e}}}return t}();!function(t){t.shiny={diffuse:function(t){return s.white},specular:function(t){return s.grey},reflect:function(t){return.7},roughness:250},t.checkerboard={diffuse:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!=0?s.white:s.black},specular:function(t){return s.white},reflect:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!=0?.1:.7},roughness:150}}(i||(i={}));var l=function(){function t(){this.maxDepth=5}return t.prototype.intersections=function(t,r){var n=1/0,e=void 0;for(var o in r.things){var i=r.things[o].intersect(t);null!=i&&i.dist<n&&(e=i,n=i.dist)}return e},t.prototype.testRay=function(t,r){var n=this.intersections(t,r);return null!=n?n.dist:void 0},t.prototype.traceRay=function(t,r,n){var e=this.intersections(t,r);return void 0===e?s.background:this.shade(e,r,n)},t.prototype.shade=function(t,r,n){var e=t.ray.dir,o=u.plus(u.times(t.dist,e),t.ray.start),i=t.thing.normal(o),c=u.minus(e,u.times(2,u.times(u.dot(i,e),i))),a=s.plus(s.background,this.getNaturalColor(t.thing,o,i,c,r)),f=n>=this.maxDepth?s.grey:this.getReflectionColor(t.thing,o,i,c,r,n);return s.plus(a,f)},t.prototype.getReflectionColor=function(t,r,n,e,o,i){return s.scale(t.surface.reflect(r),this.traceRay({start:r,dir:e},o,i+1))},t.prototype.getNaturalColor=function(t,r,n,e,o){var i=this,c=function(c,a){var f=u.minus(a.pos,r),l=u.norm(f),h=i.testRay({start:r,dir:l},o);if(void 0!==h&&h<=u.mag(f))return c;var d=u.dot(l,n),p=d>0?s.scale(d,a.color):s.defaultColor,g=u.dot(l,u.norm(e)),w=g>0?s.scale(Math.pow(g,t.surface.roughness),a.color):s.defaultColor;return s.plus(c,s.plus(s.times(t.surface.diffuse(r),p),s.times(t.surface.specular(r),w)))};return o.lights.reduce(c,s.defaultColor)},t.prototype.render=function(t,r,n,e){for(var o=0;o<e;o++)for(var i=0;i<n;i++){var c=this.traceRay({start:t.camera.pos,dir:function(t,r,o){return u.norm(u.plus(o.forward,u.plus(u.times(function(t){return(t-n/2)/2/n}(t),o.right),u.times(function(t){return-(t-e/2)/2/e}(r),o.up))))}(i,o,t.camera)},t,0),a=s.toDrawingColor(c);r.fillStyle="rgb("+String(a.r)+", "+String(a.g)+", "+String(a.b)+")",r.fillRect(i,o,i+1,o+1)}},t}(),h=-1,d=.5;document.addEventListener("keydown",function(t){console.log(t.code),{ArrowRight:function(){h+=.05},ArrowLeft:function(){h-=.05},ArrowUp:function(){d+=.05},ArrowDown:function(){d-=.05}}[t.code](),o()})},1840:function(t,r,n){"use strict";var e={level:"prd"};t.exports=e},1841:function(t,r){t.exports='<html>\n    <head>\n        <title>Ray Caster</title>\n    </head>\n    <body>\n        <canvas width="256px" height="256px"></canvas>\n    </body>\n</html>'}});